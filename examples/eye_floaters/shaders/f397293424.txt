#version 420
layout (location = 0) in vec2 coord;

uniform sampler2D tex;
uniform mat4x4 mvp_matrix;
uniform mat4x4 lod_mvp_matrix;
uniform vec2 bottom_left;
uniform vec2 top_right;
uniform float base_height;
uniform float average_height;
uniform float elevation_multiplier;

out VS_OUT {
    vec2 coord;
    vec3 corner_screen_position; // screen space approx terrain positions for selecting LOD
} vs_out;

void main(void)
{
    vs_out.coord = coord;
    vec2 xz = bottom_left + coord*(top_right-bottom_left);
    // vec4 corner_pos = mvp_matrix * vec4(xz[0], average_height, xz[1], 1);
    float h = base_height+elevation_multiplier*texture(tex, coord).r;
    vec4 corner_pos = lod_mvp_matrix * vec4(xz[0], h, xz[1], 1);
    vs_out.corner_screen_position = vec3(0.5*((corner_pos.xy / corner_pos.w) + 1), corner_pos.z);
}
