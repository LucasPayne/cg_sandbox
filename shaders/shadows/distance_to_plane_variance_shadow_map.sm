#type shading_model

block properties {
    mat4x4 vp_matrix;
}
section geom_post {
    out vec4 gl_Position(in vec3 f_world_position) {
    GLSL
        return vp_matrix * vec4(f_world_position, 1);
    END
    }
}
section frag_post {
    out vec2 moments(in vec3 f_world_position) {
    GLSL
        float d = 0.5 * (vp_matrix * vec4(f_world_position, 1)).z + 0.5;
        float dx = dFdx(d);
        float dy = dFdy(d);
        return vec2(d, d*d + 0.25*(dx*dx + dy*dy));
    END
    }
}
